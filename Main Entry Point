import asyncio
import sys
import os
from dotenv import load_dotenv
from llm.client import LLMClient
from agents.coordinator import PlannerAgent, ExecutorAgent, VerifierAgent

load_dotenv()

async def main():
    if len(sys.argv) < 2:
        print("Usage: python main.py 'your task here'")
        return

    user_task = sys.argv[1]
    
    # Initialize components
    llm = LLMClient()
    planner = PlannerAgent(llm)
    executor = ExecutorAgent()
    verifier = VerifierAgent(llm)

    print(f"\n[1/3] Planning task: {user_task}...")
    try:
        plan = planner.create_plan(user_task)
        print(f"Plan generated with {len(plan.get('steps', []))} steps.")

        print("[2/3] Executing APIs...")
        results = await executor.run_plan(plan)

        print("[3/3] Verifying and formatting...")
        final_answer = verifier.verify_and_format(user_task, results)

        print("\n--- FINAL OUTPUT ---")
        print(final_answer)
        print("---------------------\n")
        
    except Exception as e:
        print(f"Error: {str(e)}")

if __name__ == "__main__":
    asyncio.run(main())
